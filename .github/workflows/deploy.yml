name: Deploy LP Backend from landing-page branch

on:
  push:
    branches: [ "landing-page" ] 

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    # === THIẾT LẬP WORKING DIRECTORY MẶC ĐỊNH ===
    defaults:
      run:
        working-directory: ${{ github.workspace }}
    # ============================================
    
    steps:
    # 1. Checkout mã nguồn
    - name: Checkout Code
      uses: actions/checkout@v4
      
    # === BƯỚC DEBUG: IN RA THƯ MỤC HIỆN TẠI ===
    - name: Debug - Print Current Directory
      run: |
        pwd
        ls -la
    # ============================================
      
    # 2. Thiết lập Node.js
    - name: Set up Node.js Environment
      uses: actions/setup-node@v4
      with:
        node-version: '20' 
    
    # 3. Cài đặt Dependencies
    - name: Install Dependencies
      run: npm install # Lệnh này giờ chắc chắn chạy ở thư mục gốc (nơi có package.json)

    # --- BƯỚC TRIỂN KHAI (CD) ---
    
    # 4. Thiết lập SSH Agent
    - name: Setup SSH
      uses: webfactory/ssh-agent@v0.9.0
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
        
    # 5. Triển khai lên Server và Khởi động lại dịch vụ
    - name: Deploy and Restart Service
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DEPLOY_HOST }}
        username: ${{ secrets.DEPLOY_USER }}
        script: |
          # ... (Phần script này không thay đổi)